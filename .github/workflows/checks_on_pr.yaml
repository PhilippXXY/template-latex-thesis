# Main workflow that orchestrates all quality checks for pull requests
# Runs LaTeX compilation, spell check, hygiene checks, TODO checks, file quality, and required files checks
name: PR Checks

on:
  pull_request:

concurrency:
  group: pr-checks-${{ github.head_ref || github.ref }}
  cancel-in-progress: true

jobs:
  latex-compile:
    name: LaTeX Compile
    uses: ./.github/workflows/latex_compile_check.yaml
    with:
      make_target: pdf
      main_tex_for_jobname: thesis/main.tex
      fail_on_double_questionmark: true
      upload_pdf: false

  spell-check:
    name: Spell Check
    uses: ./.github/workflows/spell_check.yaml
    with:
      fail_on_errors: false
      language: en

  hygiene:
    name: Hygiene Checks
    uses: ./.github/workflows/hygiene_checks.yaml
    with:
      check_unused_bib: true
      check_duplicate_bib: true
      check_undefined_glossary: true
      fail_on_critical: true

  todo-check:
    name: TODO Check
    uses: ./.github/workflows/todo_check.yaml
    with:
      fail_on_todo: true
      include_patterns: "*.tex,*.bib,*.sty,*.cls"

  file-quality:
    name: File Quality
    uses: ./.github/workflows/file_quality_check.yaml
    with:
      check_trailing_whitespace: true
      check_final_newline: true

  required-files:
    name: Required Files
    uses: ./.github/workflows/required_files_check.yaml
    with:
      required_files: "thesis/main.tex,Makefile,latexmkrc,README.md"
